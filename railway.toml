[build]
builder = "NIXPACKS"

[environments]
  [environments.production]
    # Бэкенд
    PORT = "3000"
    JWT_SECRET = "{{#randomString 64}}{{/randomString}}"
    NODE_ENV = "production"
    
    # SMSC.RU
    SMSC_LOGIN = "{{must_env SMSC_LOGIN}}"
    SMSC_PASSWORD = "{{must_env SMSC_PASSWORD}}"
    SMSC_SENDER = "TelegramApp"
    
    # Хранилище
    UPLOADS_PATH = "/data/uploads"
    MAX_FILE_SIZE = "104857600"
    ALLOWED_TYPES = "image/*,video/*,application/pdf"
    
    # Фронтенд
    VITE_API_URL = "{{DEPLOYMENT_URL}}"
    VITE_WS_URL = "{{DEPLOYMENT_URL}}"
    VITE_BASE_URL = "{{DEPLOYMENT_URL}}"

[services.backend]
name = "backend"
root = "./backend"
buildCommand = "npm install && npm run build"
startCommand = "npm start"
healthCheckPath = "/health"

[[services.backend.volumes]]
name = "uploads-volume"
mountPath = "/data/uploads"

[services.backend.ports]
- port = 3000
  httpPath = "/"